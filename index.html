<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Employee Performance Evaluation</title>

  <!-- html2pdf.js (bundles html2canvas + jsPDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 20px;
    }
    .container {
      width: 80%;
      margin: auto;
      background-color: white;
      padding: 20px;
      border: 5px solid black;
      box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
    }
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 5px solid black;
      padding: 10px;
      background-color: #004085;
      color: white;
      font-weight: bold;
      text-align: center;
    }
    .header-title {
      font-size: 24px;
      flex-grow: 1;
      text-align: center;
    }
    .review-date {
      font-size: 14px;
      padding: 5px 10px;
      border: 2px solid white;
      border-radius: 5px;
    }
    .section-header {
      font-size: 20px;
      font-weight: bold;
      padding: 10px;
      margin-top: 20px;
      background-color: #d9534f;
      color: white;
      border: 5px solid black;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }
    table, th, td {
      border: 2px solid black;
      padding: 8px;
    }
    th {
      background-color: #004085;
      color: white;
      font-weight: bold;
      text-align: left;
    }
    table input,
    table select,
    table textarea {
      width: calc(100% - 16px);
      padding: 5px;
      border: 2px solid black;
      border-radius: 5px;
      box-sizing: border-box;
    }
    input, select, textarea {
      width: 100%;
      padding: 5px;
      border: 2px solid black;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 14px;
    }
    textarea {
      resize: vertical;
    }
    .metric-title {
      background-color: #007bff;
      color: white;
      padding: 10px;
      font-weight: bold;
      margin-top: 10px;
      border-radius: 5px;
      border: 3px solid black;
    }
    label {
      font-weight: bold;
      color: #004085;
    }
    .bold-text {
      font-weight: bold;
    }
    .download-button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 15px 32px;
      text-align: center;
      text-decoration: none;
      display: block;
      font-size: 16px;
      margin: 20px auto;
      cursor: pointer;
      border-radius: 5px;
    }
    .star-rating {
      cursor: pointer;
    }
    .star {
      font-size: 20px;
      color: gray;
      margin-right: 2px;
    }
  </style>
</head>
<body>

  <!-- Wrap entire form in a container for html2pdf -->
  <div class="container" id="form-container">

    <div class="header-container">
      <h2 class="header-title">EMPLOYEE PERFORMANCE EVALUATION FORM</h2>
      <div class="review-date">Review Date: <input type="date" /></div>
    </div>

    <div class="section-header">EMPLOYEE PERSONAL DETAILS</div>
    <table>
      <tr>
        <td class="bold-text">Employee Number</td>
        <td><input type="text" id="emp-number" /></td>
        <td class="bold-text">Employee Name</td>
        <td><input type="text" id="emp-name" /></td>
      </tr>
      <tr>
        <td class="bold-text">Position Text</td>
        <td><input type="text" id="position-text" /></td>
        <td class="bold-text">Employee Group</td>
        <td><input type="text" id="emp-group" /></td>
      </tr>
      <tr>
        <td class="bold-text">Division Text</td>
        <td><input type="text" id="division-text" /></td>
        <td class="bold-text">Department Text</td>
        <td><input type="text" id="department-text" /></td>
      </tr>
      <tr>
        <td class="bold-text">Email ID</td>
        <td><input type="email" id="email" /></td>
        <td class="bold-text">Contact Number</td>
        <td><input type="text" id="contact" /></td>
      </tr>
      <tr>
        <td class="bold-text">Reviewed By</td>
        <td><input type="text" id="reviewed-by" /></td>
        <td class="bold-text">Review Date</td>
        <td><input type="date" id="review-date" /></td>
      </tr>
    </table>

    <div class="section-header">PERFORMANCE METRICS</div>
    <div id="performance-metrics"></div>

    <div class="section-header">OVERALL EMPLOYEE PERFORMANCE</div>
    <p id="overall-performance">Not Rated</p>

    <div class="section-header">OVERALL REMARKS / COMMENTS</div>
    <textarea rows="4" id="remarks"></textarea>

    <div class="section-header">APPROVAL SIGNATURES</div>
    <table>
      <tr>
        <th>EMPLOYEE</th>
        <th>FIRST WITNESS</th>
        <th>SECOND WITNESS</th>
      </tr>
      <tr>
        <td>
          <input type="text" placeholder="NAME" class="placeholder-input" />
          <input type="text" placeholder="EMPLOYEE NUMBER" class="placeholder-input" />
          <input type="text" placeholder="POSITION / DESIGNATION" class="placeholder-input" />
          <input type="text" placeholder="SIGNATURE / DATE" class="placeholder-input" />
        </td>
        <td>
          <input type="text" placeholder="NAME" class="placeholder-input" />
          <input type="text" placeholder="EMPLOYEE NUMBER" class="placeholder-input" />
          <input type="text" placeholder="POSITION / DESIGNATION" class="placeholder-input" />
          <input type="text" placeholder="SIGNATURE / DATE" class="placeholder-input" />
        </td>
        <td>
          <input type="text" placeholder="NAME" class="placeholder-input" />
          <input type="text" placeholder="EMPLOYEE NUMBER" class="placeholder-input" />
          <input type="text" placeholder="POSITION / DESIGNATION" class="placeholder-input" />
          <input type="text" placeholder="SIGNATURE / DATE" class="placeholder-input" />
        </td>
      </tr>
    </table>

    <table>
      <tr>
        <th>REVIEWER</th>
        <th>EMPLOYEE</th>
      </tr>
      <tr>
        <td>
          <input type="text" placeholder="NAME" class="placeholder-input" />
          <input type="text" placeholder="EMPLOYEE NUMBER" class="placeholder-input" />
          <input type="text" placeholder="POSITION / DESIGNATION" class="placeholder-input" />
          <input type="text" placeholder="SIGNATURE / DATE" class="placeholder-input" />
        </td>
        <td>
          <input type="text" placeholder="NAME" class="placeholder-input" />
          <input type="text" placeholder="EMPLOYEE NUMBER" class="placeholder-input" />
          <input type="text" placeholder="POSITION / DESIGNATION" class="placeholder-input" />
          <input type="text" placeholder="SIGNATURE / DATE" class="placeholder-input" />
        </td>
      </tr>
    </table>
  </div>

  <button class="download-button" onclick="downloadPDF()">Download PDF</button>

  <script>
    // -----------------------------------------
    // 1) DEFINE METRICS & RENDER THEM IN DOM
    // -----------------------------------------
    const metrics = [
      {
        title: "1. TECHNICAL KNOWLEDGE",
        details: `
          <b style="margin-right: 5px;">HVAC Systems Understanding:</b> Knowledge of various AC systems, including residential, commercial, and industrial units.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b style="margin-right: 5px;">Diagnostics and Troubleshooting:</b> Ability to diagnose issues accurately using appropriate tools and techniques.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b style="margin-right: 5px;">Electrical Knowledge:</b> Understanding of electrical components and wiring in HVAC systems, including capacitors, relays, and circuit boards.<br><br>
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b style="margin-right: 5px;">Refrigeration Knowledge:</b> Familiarity with refrigeration cycles, refrigerants, and their proper handling and charging procedures.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
        `
      },
      {
        title: "2. HANDS-ON SKILLS",
        details: `
          <b>Installation Skills:</b> Competence in installing AC units, including proper setup, connections, and system configuration.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b>Repair Skills:</b> Proficiency in repairing faulty components, including compressors, fans, coils, thermostats, and wiring.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b>Maintenance Skills:</b> Ability to perform routine maintenance tasks such as cleaning filters, coils, and condensers, checking refrigerant levels, and ensuring system efficiency.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
        `
      },
      {
        title: "3. PROBLEM-SOLVING ABILITY",
        details: `
          <b>Diagnosing Complex Issues:</b> Ability to identify and troubleshoot complex mechanical or electrical problems.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b>Efficient Solutions:</b> Ability to devise practical, cost-effective solutions to fix problems or improve system performance.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b>Adaptability:</b> Adjusting solutions based on the specific needs of the environment (e.g., residential vs. commercial setups).
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
        `
      },
      {
        title: "4. ATTENTION TO DETAIL",
        details: `
          <b>Precision:</b> Ensuring all installations, repairs, and maintenance are completed accurately and to manufacturer specifications.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b>Safety Compliance:</b> Adhering to safety guidelines and protocols, such as handling refrigerants safely, working with electricity, and ensuring proper ventilation.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
        `
      },
      // ... You can include the rest of your metrics here ...
      {
        title: "5. CUSTOMER SERVICE SKILLS",
        details: `
          <b>Communication:</b> Explaining technical issues and solutions to customers in an understandable and professional manner.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b>Professionalism:</b> Maintaining a courteous, friendly, and respectful demeanor when interacting with customers, whether on-site or over the phone.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
          <b>Customer Education:</b> Offering advice on system maintenance, energy-saving tips, and how to operate AC units properly.
          <div style="border-bottom: 1px solid #ddd; margin: 10px 0;"></div>
        `
      },
      // ... etc. for metrics 6 to 13 ...
    ];

    const metricsContainer = document.getElementById("performance-metrics");
    const overallPerformanceText = document.getElementById("overall-performance");

    // Dynamically insert each metric into the DOM
    metrics.forEach((metric, index) => {
      const metricDiv = document.createElement("div");
      metricDiv.classList.add("performance-feedback");
      metricDiv.innerHTML = `
        <div class="metric-title"><b>${metric.title}</b></div>
        <p>${metric.details}</p>
        <div class="feedback-container" data-metric-index="${index}" data-rating="0">
          <div class="star-rating">
            <span class="star" data-value="1">★</span>
            <span class="star" data-value="2">★</span>
            <span class="star" data-value="3">★</span>
            <span class="star" data-value="4">★</span>
            <span class="star" data-value="5">★</span>
          </div>
          <span class="feedback-text" id="feedback-desc-${index}">Not Rated</span>
        </div>
        <div style="margin-top: 15px;">
          <label for="comments-${index}"><b>Employee Comments:</b></label>
          <textarea id="comments-${index}" rows="4" placeholder="Enter your comments here..."></textarea>
        </div>
      `;
      metricsContainer.appendChild(metricDiv);
    });

    // -----------------------------------------
    // 2) STAR RATINGS LOGIC
    // -----------------------------------------
    metricsContainer.addEventListener("click", function (event) {
      if (event.target.classList.contains("star")) {
        const star = event.target;
        const starContainer = star.closest(".feedback-container");
        const metricIndex = starContainer.dataset.metricIndex;
        const selectedValue = star.dataset.value;
        highlightStars(starContainer, selectedValue);
        updateFeedback(metricIndex, selectedValue);
        starContainer.dataset.rating = selectedValue;
        updateOverallPerformance();
      }
    });

    function highlightStars(starContainer, selectedValue) {
      const stars = starContainer.querySelectorAll(".star");
      stars.forEach((star) => {
        const starValue = star.dataset.value;
        star.style.color = starValue <= selectedValue ? "gold" : "gray";
      });
    }

    function updateFeedback(index, value) {
      const feedbackDesc = document.getElementById(`feedback-desc-${index}`);
      const descriptions = {
        "1": "Poor Performance",
        "2": "Average Performance - Needs Improvement",
        "3": "Good Performance",
        "4": "Very Good Performance",
        "5": "Excellent Performance",
      };
      feedbackDesc.textContent = descriptions[value] || "Not Rated";
    }

    function updateOverallPerformance() {
      const starContainers = metricsContainer.querySelectorAll(".feedback-container");
      const ratings = Array.from(starContainers, (container) =>
        parseInt(container.dataset.rating) || 0
      ).filter((rating) => rating > 0);

      // If all metrics are rated (e.g., 13 total)
      if (ratings.length === metrics.length) {
        const average = ratings.reduce((a, b) => a + b, 0) / ratings.length;
        const roundedAverage = Math.round(average);
        const descriptions = {
          1: "Poor Performance",
          2: "Average Performance - Needs Improvement",
          3: "Good Performance",
          4: "Very Good Performance",
          5: "Excellent Performance",
        };
        overallPerformanceText.textContent = descriptions[roundedAverage] || "Not Rated";
      } else {
        overallPerformanceText.textContent = "Please rate all metrics.";
      }
    }

    // -----------------------------------------
    // 3) DOWNLOAD PDF USING html2pdf.js
    // -----------------------------------------
    function downloadPDF() {
      // Target the entire form container
      const element = document.getElementById("form-container");

      // Configure html2pdf options
      const opt = {
        margin:       0,
        filename:     'Employee_Performance_Evaluation.pdf',
        image:        { type: 'jpeg', quality: 1.0 },
        html2canvas:  { scale: 2, useCORS: true, scrollX: 0, scrollY: 0 },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      // Generate and download the PDF
      html2pdf().from(element).set(opt).save();
    }
  </script>
</body>
</html>
